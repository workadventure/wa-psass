var b=Object.defineProperty;var v=(e,t,a)=>t in e?b(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var s=(e,t,a)=>(v(e,typeof t!="symbol"?t+"":t,a),a);const d="https://werewolves.wa-map-optimizer.com",V=600,p=()=>{WA.player.state.role===void 0&&WA.player.state.saveVariable("role",void 0,{public:!1,persist:!0,scope:"room"}),WA.state.night===void 0&&WA.state.saveVariable("night",!1),WA.state.day===void 0&&WA.state.saveVariable("day",!1),WA.state.roles===void 0&&WA.state.saveVariable("roles",{villagers:[],werewolfs:[],yougGirl:void 0,leader:void 0})};class w{constructor(){s(this,"sound");s(this,"config");s(this,"showLayers",["Day","DayItems"]);s(this,"isActive",!1);this.sound=WA.sound.loadSound("day.mp3"),this.config={volume:1,loop:!1,rate:1,detune:1,delay:0,seek:0,mute:!1}}start(){this.showLayers.forEach(c=>WA.room.showLayer(c)),WA.ui.modal.closeModal(),WA.ui.actionBar.removeButton("day-btn"),this.sound.play(this.config);const t=`${d}/pages/day`;let a=`${t}/villagerInstruction.html`;switch(WA.player.state.role){case i.wolf:a=`${t}/wolfInstruction.html`;break;case i.hunter:a=`${t}/hunterInstruction.html`;break;case i.leader:a=`${t}/leaderInstruction.html`;break;case i.youggirl:a=`${t}/younggirlInstruction.html`;break;case i.villager:a=`${t}/villagerInstruction.html`;break}console.log("start Day",a),setTimeout(()=>{WA.ui.modal.openModal({allowApi:!0,position:"left",allow:"fullscreen",src:a,title:"Day"})},600),n()&&WA.ui.actionBar.addButton({id:"night-btn",label:"LA NUIT TOMBE 🌛",callback:()=>{console.log("Night"),WA.state.day=!1,WA.state.night=!0}}),this.isActive=!0}end(){this.showLayers.forEach(t=>WA.room.hideLayer(t)),this.sound.stop(),WA.ui.modal.closeModal(),WA.room.showLayer("Day"),WA.room.showLayer("DayItems"),WA.player.state.role===i.leader&&WA.ui.actionBar.removeButton("night-btn"),this.isActive=!1}get active(){return this.isActive}}class B{constructor(){s(this,"sound");s(this,"config");s(this,"showLayers",["Night","NightItems"]);s(this,"isActive",!1);this.sound=WA.sound.loadSound("night.mp3"),this.config={volume:1,loop:!1,rate:1,detune:1,delay:0,seek:0,mute:!1}}async start(){this.showLayers.forEach(c=>WA.room.showLayer(c)),WA.ui.modal.closeModal(),WA.ui.actionBar.removeButton("night-btn"),this.sound.play(this.config);const t=`${d}/pages/night`;let a=`${t}/villagerInstruction.html`;switch(WA.player.state.role){case i.wolf:a=`${t}/wolfInstruction.html`;break;case i.hunter:a=`${t}/hunterInstruction.html`;break;case i.leader:a=`${t}/leaderInstruction.html`;break;case i.youggirl:a=`${t}/younggirlInstruction.html`;break;case i.villager:a=`${t}/villagerInstruction.html`;break}setTimeout(()=>{WA.ui.modal.openModal({allowApi:!0,position:"left",allow:"fullscreen",src:a,title:"Night"})},600),n()&&WA.ui.actionBar.addButton({id:"day-btn",label:"LE JOUR SE LÈVE ☀️",callback:()=>{WA.state.day=!0,WA.state.night=!1}}),this.isActive=!0}end(){this.showLayers.forEach(t=>WA.room.hideLayer(t)),console.log("this sound",this.sound),this.sound.stop(),WA.ui.modal.closeModal(),WA.player.state.role===i.leader&&WA.ui.actionBar.removeButton("day-btn"),this.isActive=!1}get active(){return this.isActive}}class L{constructor(){s(this,"isActive",!1)}async start(){setTimeout(()=>{WA.ui.modal.openModal({allowApi:!0,position:"left",allow:"fullscreen",src:`${d}/pages/myRole.html`,title:"My Role"})},600),this.isActive=!0}async end(){WA.ui.modal.closeModal(),this.isActive=!1}get active(){return this.isActive}}const i={wolf:"WOLF",hunter:"HUNTER",villager:"VILLAGER",youggirl:"YOUNGGIRL",leader:"LEADER"},n=()=>WA.state.leaderUuid!=null&&WA.state.leaderUuid===WA.player.uuid,k=e=>e===i.villager,T=e=>e===i.wolf,$=e=>e===i.youggirl;let l;function h(e){l==null&&(l=new L),e==!1&&l.active==!0?l.end():e==!0&&l.active==!1&&l.start()}function m(){WA.ui.modal.openModal({allowApi:!0,position:"center",allow:"fullscreen",src:`${d}/pages/waitingRoom.html`,title:"Waiting Room"})}function W(){WA.ui.actionBar.removeButton("game-btn"),WA.ui.actionBar.removeButton("night-btn"),WA.ui.actionBar.removeButton("day-btn"),setTimeout(()=>{WA.ui.actionBar.addButton({id:"game-btn",label:"Loup garou 🐺",callback:async()=>{await WA.state.saveVariable("leaderUuid",WA.player.uuid),WA.state.startGame=!0,m()}})},600)}function f(){WA.ui.actionBar.removeButton("game-btn"),setTimeout(()=>{WA.ui.actionBar.addButton({id:"game-btn",label:"Finir la partie ❌",callback:async()=>{await WA.state.saveVariable("leaderUuid",void 0),WA.state.startGame=!1}})},600)}let o;function A(e){console.log("toggleNightView",e,o==null?void 0:o.active),o==null&&(o=new B),e==!1&&o.active==!0?o.end():e==!0&&o.active==!1&&o.start()}let r;function g(e){r==null&&(r=new w),e==!1&&r.active==!0?r.end():e==!0&&r.active==!1&&r.start()}function E(){p(),WA.player.state.role!=null&&WA.state.startGame?(WA.state.night?A(!0):WA.state.day?g(!0):h(!0),n()&&f()):WA.state.startGame?(m(),n()&&f()):W(),WA.state.onVariableChange("startGame").subscribe(e=>{console.log("startGame => onVariableChange => ",e),e==!0?(m(),n()&&f()):(WA.ui.website.getAll().then(t=>{t.forEach(a=>{a.close()})}),WA.ui.modal.closeModal(),h(!1),g(!1),A(!1),W())}),WA.state.onVariableChange("night").subscribe(e=>{console.info("Is the Night",e),A(e)}),WA.state.onVariableChange("day").subscribe(e=>{console.info("Is the Day",e),g(e)}),WA.state.onVariableChange("roles").subscribe(e=>{console.log("roles => onVariableChange => ",e);const{villagers:t,werewolfs:a,yougGirl:c,leader:y}=e;let u;a.includes(WA.player.uuid)?u=i.wolf:t.includes(WA.player.uuid)?u=i.villager:c===WA.player.uuid?u=i.youggirl:y===WA.player.uuid&&(u=i.leader),WA.player.state.saveVariable("role",u,{public:!1,persist:!0,scope:"room"}),WA.ui.modal.closeModal(),h(!0),n()&&WA.ui.actionBar.addButton({id:"night-btn",label:"LA NUIT TOMBE 🌛",callback:()=>{console.log("Night"),WA.state.saveVariable("day",!1),WA.state.saveVariable("night",!0)}})})}export{k as a,$ as b,n as c,V as d,E as e,d as h,T as i,i as r};
